/*! bzModel v0.1.0 by Vitalii Savchuk(esvit666@gmail.com) - https://github.com/esvit/bz-model - New BSD License */

!function(a,b){return"function"==typeof define&&define.amd?(define(["angular"],function(a){return b(a)}),void 0):b(a)}(angular||null,function(a){var b=a.module("bzModel",["elasticjs.service"]);return b.provider("bzModel",[function(){var b=this;this.$url="http://localhost:9200",this.$index="default",this.url=function(a){return this.$url=a,this},this.index=function(a){return this.$index=a,this},this.$get=["$q","$log","ejsResource",function(c,d,e){var f=e(b.$url);return function(d){var e=function(b){a.extend(this,d||{}),a.extend(this,d.$defaults||{}),a.extend(this,b||{}),this.$initialize()};e.prototype.$initialize=d.$initialize||e.prototype.$initialize||a.noop,e.$client=function(){return f};var g=function(b){var c=[];return a.forEach(b,function(b,d){if(!a.isUndefined(b)&&""!=b&&"$"!=d[0]){var e=a.isArray(b)?f.TermsFilter:f.TermFilter;c.push(e(d,b))}}),c.length?(a.isObject(b.$exclude)&&c.push(f.NotFilter(g(b.$exclude))),1==c.length?c[0]:f.AndFilter(c)):null};return e.prototype.$search=function(){var h=f.Request().indices(b.$index).types(d.$name||"default"),i=f.MatchAllQuery(),j=[];a.forEach(arguments,function(b){if(!a.isUndefined(b)){var c=g(b);c&&j.push(c)}}),1==j.length?i=f.FilteredQuery(i,j[0]):j.length>1&&(i=f.FilteredQuery(i,f.OrFilter(j)));var k=f.TermsFilter("tags.title",["дтп"]);return h.facet(f.TermsFacet("tagsFacet").field("tags.title").allTerms(!1).facetFilter(f.AndFilter([k]))),h.$execute=function(a){return this.$fetch(i,a)},h.$get=function(a){return a=a||{},a.page=1,a.count=1,this.$fetch(i,a)},h.$fetch=function(b,d){d=d||{},d.page=d.page||1,d.count=d.count||10;var g=c.defer(),h=1==d.count?{}:[];if(h.$promise=g.promise,h.$resolved=!1,h.$meta={},this.from((d.page-1)*d.count),this.size(d.count),d.sorting){var i=[];a.forEach(d.sorting,function(a,b){var c=f.Sort(b).asc();"desc"==a&&c.desc(),i.push(c)}),this.sort(i)}return this.query(b||f.MatchAllQuery()).doSearch().then(function(b){var c=[];if(h.$total=b.hits.total,h.$max_score=b.hits.max_score,h.$resolved=!0,1==d.count){if(h.$total>0){var f=new e(b.hits.hits[0]._source);a.copy(f,h)}return g.resolve(h),void 0}for(var i=0,j=b.hits.hits.length;j>i;i++){var f=new e(b.hits.hits[i]._source);c.push(f)}a.copy(c,h),g.resolve(h)}),h},h},e}}]}]),b});
//# sourceMappingURL=bz-model.map